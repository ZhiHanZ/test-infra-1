apiVersion: batch/v1
kind: Job
metadata:
  name: perf-tool-current
spec:
  template:
    spec:
      containers:
        - name: perf-tool-current
          image: zhihanz/perf-tool:dns
          command:
            - sh
            - "-c"
            - |
              /bin/bash <<'EOF'
              echo "Start benchmarking on {{ .CURRENT }}"
              mkdir -p result
              python3 perfs.py --region ap-nanjing --bucket test-1306375239 \
                                --path benchmark/current --secretID AKIDMWQ3PUIo54mDPL1QYQ1LOAftrZ0A4g27 \
                                --secretKey pNfhRu72g38xVmlUxrZ3JL7ewyjFVVFj --type COS \
                                --bin ./fuse-benchmark --output result \
                                --host current-service.default.svc.cluster.local --port 9001

              EOF
      restartPolicy: Never
  backoffLimit: 4